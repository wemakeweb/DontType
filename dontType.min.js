/*	Copyright (c) 2011 Sebastian Otto, http://wemakeweb.de/
	Licensed under the MIT license.
*/
(function(c,b,a,e){c.fn.dontType=function(i){var g=c.data(this[0],"dontTypeInstance"),f=c.data(a.body,"dontTypePid"),h=Array.prototype.slice.call(arguments,1);if(f){c.data(a.body,"dontTypePid",f++)}else{f=c.data(a.body,"dontTypePid",1)}return this.map(function(j,k){return new d.init(k,i,f,h)})};var d={init:function(j,h,f,g){var i=this;i.pid=f,i.hittedPoints=[];if(j.type!=="password"){return j}i.defaults=c.extend({width:155,height:155,padding:25,radius:14,styles:{dotGradient:{from:"rgba(49,49,49,0.95)",to:"rgba(35,35,35,0.95)"},dotInner:"rgb(255,255,255)",dotActiveInner:"rgb(123,217,62)",dotActiveBorder:"rgb(172,172,172)",lineColor:"rgba(207,207,207,0.85)"},convertMap:[1,2,3,4,5,6,7,8,9],noSupport:function(){},},h);if(i.checkSupport()){i.input=c(j).hide();i.setup(i.input)}else{i.defaults.noSupport.call();i.noSupport=true}return c(this)},checkSupport:function(){return !!a.createElement("canvas").getContext},updateInput:function(){var f="",g=this;c.each(g.hittedPoints,function(h,j){f+=g.defaults.convertMap[j[1]*3+j[0]]});c(this.input).val(f)},setup:function(i){var h=this,g=a.createElement("canvas"),f=false;g.width=h.defaults.width;g.height=h.defaults.height;g.id="dontTypeCtx"+h.pid;c(i).parent().append(g);c(a.getElementById("dontTypeCtx"+h.pid)).data({dontTypeInstance:h}).bind("mousedown mouseup mousemove mouseout touchstart touchmove touchend touchcancel",function(k){var j,l;if(k.type==="touchstart"||k.type==="touchmove"){j=k.originalEvent.touches[0].pageX-this.offsetLeft;l=k.originalEvent.touches[0].pageY-this.offsetTop;k.preventDefault()}else{j=k.pageX-this.offsetLeft;l=k.pageY-this.offsetTop}switch(k.type){case"mousedown":case"touchstart":h.mousedown=true;if(h.hittedPoints.length){h.connect(j,l)}else{h.start(j,l)}break;case"mouseup":case"mouseout":case"touchcancel":case"touchend":h.mousedown=false;break;case"mousemove":case"touchmove":h.mousedown&&h.connect(j,l);break}});h.ctx=f=a.getElementById("dontTypeCtx"+h.pid).getContext("2d");h.pixelSteps=Math.floor((h.defaults.width)/3);c.each([[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]],function(k,j){h.drawPoint.call(h,[h.defaults.padding+(h.pixelSteps*j[1]),h.defaults.padding+(h.pixelSteps*j[0])],false)})},drawPoint:function(f,j){var i=this,g=i.ctx;g.beginPath();if(j){g.globalCompositeOperation="destination-over";g.arc(f[0],f[1],i.defaults.radius+2,0,2*Math.PI,false);g.fillStyle=i.defaults.styles.dotActiveInner}else{g.arc(f[0],f[1],i.defaults.radius,0,Math.PI*2,true);var h=g.createLinearGradient(f[0],f[1],f[0],f[1]+40);h.addColorStop(0,i.defaults.styles.dotGradient.from);h.addColorStop(0.7,i.defaults.styles.dotGradient.to);g.fillStyle=h}g.fill();g.closePath();g.beginPath();if(j){g.globalCompositeOperation="destination-over";g.arc(f[0],f[1],i.defaults.radius+3,0,2*Math.PI,false);g.fillStyle=i.defaults.styles.dotActiveBorder}else{g.globalCompositeOperation="source-over";g.arc(f[0],f[1],6,0,Math.PI*2,true);g.fillStyle=i.defaults.styles.dotInner}g.fill();g.closePath()},notUsed:function(f){if(this.hittedPoints.length){return !c.grep(this.hittedPoints,function(h,g){return h[0]===f[0]&&h[1]===f[1]}).length}else{return true}},hit:function(h,l){var k=this.pixelSteps,i=Math.floor(h/k),j=Math.floor(l/k),g=[this.defaults.padding+i*k,this.defaults.padding+j*k],f=this.defaults.radius;return(h>(g[0]-f)&&h<(g[0]+f)&&l>(g[1]-f)&&l<(g[1]+f)&&h<this.defaults.width&&l<this.defaults.height&&this.notUsed([i,j]))?[i,j]:false},connect:function(h,l){var k=this,g=k.hit(h,l),i=k.ctx,j=k.hittedPoints,f=j.length;if(!!g){k.drawPoint([k.defaults.padding+(g[0]*k.pixelSteps),k.defaults.padding+(g[1]*k.pixelSteps)],true);this.hittedPoints.push(g);k.updateInput();i.globalCompositeOperation="source-over";i.beginPath();i.strokeStyle="rgba(207,207,207,0.85)";i.lineCap="round";i.lineWidth=14;i.moveTo(k.defaults.padding+j[f-1][0]*k.pixelSteps,k.defaults.padding+j[f-1][1]*k.pixelSteps);i.lineTo(k.defaults.padding+j[f][0]*k.pixelSteps,k.defaults.padding+j[f][1]*k.pixelSteps);i.stroke()}},start:function(g,i){var h=this,f=h.hit(g,i);if(!!f){h.drawPoint([h.defaults.padding+(f[0]*h.pixelSteps),h.defaults.padding+(f[1]*h.pixelSteps)],true);this.hittedPoints.push(f);h.updateInput()}},};d.init.prototype=d})(jQuery,this,this.document);